<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>
<body>
<h2>17.3 chardet</h2><div class="x-wiki-content x-main-content"><p>字符串编码一直是令人非常头疼的问题，尤其是我们在处理一些不规范的第三方网页的时候。虽然Python提供了Unicode表示的<code>str</code>和<code>bytes</code>两种数据类型，并且可以通过<code>encode()</code>和<code>decode()</code>方法转换，但是，在不知道编码的情况下，对<code>bytes</code>做<code>decode()</code>不好做。</p>
<p>对于未知编码的<code>bytes</code>，要把它转换成<code>str</code>，需要先“猜测”编码。猜测的方式是先收集各种编码的特征字符，根据特征字符判断，就能有很大概率“猜对”。</p>
<p>当然，我们肯定不能从头自己写这个检测编码的功能，这样做费时费力。chardet这个第三方库正好就派上了用场。用它来检测编码，简单易用。</p>
<h3><a name="#-E5-AE-89-E8-A3-85chardet"></a>安装chardet</h3>
<p>如果安装了Anaconda，chardet就已经可用了。否则，需要在命令行下通过pip安装：</p>
<pre><code>$ pip install chardet
</code></pre><p>如果遇到Permission denied安装失败，请加上sudo重试。</p>
<h3><a name="#-E4-BD-BF-E7-94-A8chardet"></a>使用chardet</h3>
<p>当我们拿到一个<code>bytes</code>时，就可以对其检测编码。用chardet检测编码，只需要一行代码：</p>
<pre><code>&gt;&gt;&gt; chardet.detect(b'Hello, world!')
{'encoding': 'ascii', 'confidence': 1.0, 'language': ''}
</code></pre><p>检测出的编码是<code>ascii</code>，注意到还有个<code>confidence</code>字段，表示检测的概率是1.0（即100%）。</p>
<p>我们来试试检测GBK编码的中文：</p>
<pre><code>&gt;&gt;&gt; data = '离离原上草，一岁一枯荣'.encode('gbk')
&gt;&gt;&gt; chardet.detect(data)
{'encoding': 'GB2312', 'confidence': 0.7407407407407407, 'language': 'Chinese'}
</code></pre><p>检测的编码是<code>GB2312</code>，注意到GBK是GB2312的超集，两者是同一种编码，检测正确的概率是74%，<code>language</code>字段指出的语言是<code>'Chinese'</code>。</p>
<p>对UTF-8编码进行检测：</p>
<pre><code>&gt;&gt;&gt; data = '离离原上草，一岁一枯荣'.encode('utf-8')
&gt;&gt;&gt; chardet.detect(data)
{'encoding': 'utf-8', 'confidence': 0.99, 'language': ''}
</code></pre><p>我们再试试对日文进行检测：</p>
<pre><code>&gt;&gt;&gt; data = '最新の主要ニュース'.encode('euc-jp')
&gt;&gt;&gt; chardet.detect(data)
{'encoding': 'EUC-JP', 'confidence': 0.99, 'language': 'Japanese'}
</code></pre><p>可见，用chardet检测编码，使用简单。获取到编码后，再转换为<code>str</code>，就可以方便后续处理。</p>
<p>chardet支持检测的编码列表请参考官方文档<a href="https://chardet.readthedocs.io/en/latest/supported-encodings.html" target="_blank">Supported encodings</a>。</p>
<h3><a name="#-E5-B0-8F-E7-BB-93"></a>小结</h3>
<p>使用chardet检测编码非常容易，chardet支持检测中文、日文、韩文等多种语言。</p>
</div>
</body>
</html>